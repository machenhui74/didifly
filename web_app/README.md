# 儿童视觉训练方案生成系统 - Web版

这是儿童视觉训练方案生成系统的Web版本，基于原有的桌面GUI应用程序开发。

## 功能特点

- 基于Flask的Web应用，可部署到服务器上
- 响应式设计，适配不同设备屏幕
- 保留了原有系统的所有功能
- 美观的用户界面，易于使用
- 优化的布局设计：所有卡片占屏幕宽度的50%并居中显示，输入框长度缩短
- 增强的响应式设计：在小窗口状态下自动调整卡片宽度为适合的比例
- 用户认证系统：添加登录功能，保护系统安全
- 管理员后台：提供用户管理功能，可以添加、编辑和删除用户
- 安全存储：用户密码使用SHA-256加盐哈希存储，提高安全性
- 模块化设计：代码结构已重构为多个模块，便于维护和扩展

## 安装说明

1. 确保已安装Python 3.7或更高版本
2. 安装依赖包：

```bash
pip install -r requirements.txt
```

## 配置说明

系统配置已模块化，所有配置选项都已移至`config.py`文件中：

```python
# 数据文件夹路径 - 可以通过环境变量传入
SOURCE_FOLDER = os.environ.get('SOURCE_FOLDER', r"D:\23")
DESTINATION_FOLDER = os.environ.get('DESTINATION_FOLDER', r"D:\学员训练方案")
DATA_FOLDER = os.environ.get('DATA_FOLDER', os.path.join(os.path.dirname(os.path.abspath(__file__)), 'data'))
USERS_FILE = os.path.join(DATA_FOLDER, 'users.json')
STUDENT_PROFILES_FILE = os.path.join(DATA_FOLDER, 'student_profiles.json')
```

请根据您的实际情况修改这些路径。

## 用户账号管理

系统提供了完整的用户账号管理功能：

1. 默认管理员账号
   - 用户名：admin
   - 密码：admin123

2. 用户管理功能（仅管理员可用）
   - 查看所有用户列表
   - 添加新用户
   - 编辑现有用户信息
   - 删除用户账号

3. 安全存储
   - 所有用户数据存储在 `data/users.json` 文件中
   - 密码使用SHA-256算法加盐哈希存储，提高安全性
   - 即使服务器重启，用户数据也不会丢失

## 运行说明

在命令行中执行以下命令启动应用：

```bash
python app.py
```

然后在浏览器中访问 http://127.0.0.1:5000/ 即可使用系统。系统会自动重定向到登录页面，使用管理员账号登录后即可使用所有功能。

## 部署到服务器

如果您想将应用部署到服务器上，可以使用以下方法：

### 使用Gunicorn（Linux/macOS）

```bash
pip install gunicorn
gunicorn -w 4 -b 0.0.0.0:8000 app:app
```

### 使用Waitress（Windows）

```bash
pip install waitress
waitress-serve --port=8000 app:app
```

## 文件结构

```
web_app/
├── app.py                # 主应用程序
├── auth.py               # 认证模块
├── users.py              # 用户管理模块
├── config.py             # 配置模块
├── static/               # 静态文件
│   └── css/              # CSS样式表
│       └── style.css     # 主样式表
├── templates/            # HTML模板
│   ├── base.html         # 基础模板
│   ├── index.html        # 首页/表单页
│   ├── login.html        # 登录页面
│   ├── admin.html        # 管理员后台页面
│   └── results.html      # 结果页
├── data/                 # 数据存储目录
│   └── users.json        # 用户数据文件
└── requirements.txt      # 依赖包列表
```

## 最近更新

### 2025年5月最新版本 (v2.1)
- 完成了代码重构，将应用分解为多个模块：
  - `config.py`: 所有配置参数
  - `auth.py`: 认证和密码管理功能
  - `users.py`: 用户管理功能
  - `app.py`: 主应用和路由定义
- 代码结构更加清晰，便于维护和扩展
- 修复了后台管理页面中的路由引用错误

### 2025年4月更新 (v2)
- 进一步优化了学生档案查询功能：
  - 集成了门店筛选功能到"所属门店"列标题中，取消单独的筛选控件
  - 增加了多选筛选功能，可同时选择多个门店进行筛选
  - 添加了直观的筛选状态指示器（蓝色表示未筛选，红色表示已筛选）
  - 改进了筛选交互体验，更加符合用户习惯

### 2025年4月更新 (v1)
- 优化了学生档案查询功能：
  - 删除了多余的当前门店提示信息
  - 添加了"所属门店"列，放置在测评日期和测评师之间
  - 新增门店筛选功能，可根据所属门店筛选学生档案
  - 优化了表格布局和排序功能，支持按门店排序
- 修改了文件结构，使查找学生档案更加直观高效

### 2025年3月版本
- 完全重新设计了搜索框与列表的对齐方式，确保搜索框与表格完全左对齐
- 修复了下载选中功能，使用iframe方式处理下载，避免页面跳转导致的下载问题
- 修复了下载选中功能的重定向问题，确保错误处理正确
- 添加了管理员后台功能，可以管理用户账号
- 实现了用户数据的安全存储，使用SHA-256加盐哈希存储密码
- 优化了用户管理界面，输入框变短并居中设计
- 去掉了退出登录时的成功提示，简化用户体验
- 增强了系统安全性，防止未授权访问

### 2023年版本
- 优化了所有卡片的布局，现在所有卡片只占用屏幕宽度的50%并居中显示
- 缩短了所有输入框的长度，使其更适合输入简短的文本和数字
- 重新设计了按钮组布局，使"重置表单"和"生成训练方案"按钮居中并相邻排列
- 统一了测评数据和结果页面的样式，提高了用户体验的一致性
- 选项卡标签与卡片对齐，保持界面一致性
- 增强了响应式设计：
  - 小窗口状态下（<768px）：卡片宽度调整为90%
  - 中等窗口状态下（768px-991px）：卡片宽度调整为70%
  - 大窗口状态下（>991px）：保持卡片宽度为50%
- 添加了用户认证系统：
  - 炫酷但低调的登录界面，位于页面右侧
  - 用户登录后显示用户名和退出按钮
  - 保护系统安全，未登录用户无法访问功能页面

## 安全建议

- 定期备份 `data` 目录中的用户数据文件
- 考虑更改默认管理员密码，提高系统安全性
- 限制 `data` 目录的访问权限，只允许应用程序访问
- 在生产环境中，可以考虑使用更安全的存储方式，如数据库
- 确保源文件夹和目标文件夹路径正确
- 确保应用有足够的权限读写这些文件夹
- 如果部署到服务器上，请确保服务器环境中已安装所有依赖 

## 技术文档

### 模块设计

1. `config.py`
   - 集中管理所有配置参数
   - 支持通过环境变量覆盖默认配置

2. `auth.py`
   - 用户认证功能
   - 密码加密和验证
   - 权限控制装饰器

3. `users.py`
   - 用户数据管理
   - 添加、更新和删除用户

4. `app.py`
   - 应用主入口
   - 路由定义
   - 学生档案管理
   - 训练方案生成

### 数据结构

1. 用户数据格式
```json
{
  "username": {
    "password": "salt$hashed_password",
    "name": "用户显示名称",
    "store": "所属门店",
    "is_encrypted": true
  }
}
```

2. 学生档案格式
```json
{
  "name": "学生姓名",
  "age": 年龄,
  "dob": "出生日期",
  "test_date": "测评日期",
  "training_center": "训练中心",
  "assessor": "测评师",
  "submitted_by": "提交用户",
  "submitted_at": "提交时间",
  "vb": 视觉广度分数,
  "vb_current": "视觉广度评级",
  "vb_target": 视觉广度目标分数,
  ...
}
``` 